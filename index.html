<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discover - Unfiltered Liquidity Pools</title>
    <style>
        body {font-family:Arial,sans-serif;background:#111;color:#eee;margin:0;padding:20px;}
        .header {display:flex;flex-wrap:wrap;gap:15px;align-items:center;margin-bottom:20px;}
        h1 {margin:0;font-size:24px;}
        .search-bar {padding:10px;width:300px;background:#333;border:none;border-radius:4px;color:white;}
        .filters select {padding:8px;background:#333;color:white;border:1px solid #555;border-radius:4px;}
        table {width:100%;border-collapse:collapse;background:#222;font-size:14px;overflow-x:auto;display:block;white-space:nowrap;}
        th,td {padding:10px 12px;border-bottom:1px solid #444;text-align:right;}
        th {background:#333;cursor:pointer;user-select:none;}
        th:first-child,td:first-child {text-align:left;}
        .pair-cell {display:flex;align-items:center;gap:10px;}
        .mini-chart {width:110px;height:36px;background:#222;border:1px solid #444;border-radius:2px;overflow:hidden;}
        .star {cursor:pointer;font-size:18px;}
        .simulate {background:#0066ff;color:white;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:12px;}
        .positive {color:#00ff88;}
        .footer-controls {margin-top:20px;text-align:right;}
        .footer-controls select {padding:8px;background:#333;color:white;border:1px solid #555;border-radius:4px;}
    </style>
</head>
<body>
    <div class="header">
        <h1>Discover - Unfiltered Liquidity Pools</h1>
        <input type="text" class="search-bar" placeholder="Search pair..." id="searchInput">
        <div class="filters">
            <select id="dexFilter"></select>
            <select id="chainFilter"></select>
            <select id="timeFilter">
                <option>30 Days</option>
                <option>7 Days</option>
                <option>24 Hours</option>
            </select>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th onclick="sortTable(0)">Pair</th>
                <th onclick="sortTable(1)">Age</th>
                <th onclick="sortTable(2)">TVL</th>
                <th onclick="sortTable(3)">Fees (24h)</th>
                <th onclick="sortTable(4)">Fee/TVL</th>
                <th class="positive" onclick="sortTable(5)">APR (Adj. IL)</th>
                <th onclick="sortTable(6)">Volatility</th>
                <th onclick="sortTable(7)">Correlation</th>
                <th onclick="sortTable(8)">Rewards/TVL</th>
                <th onclick="sortTable(9)">Volume/TVL</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="poolsBody"></tbody>
    </table>

    <div class="footer-controls">
        Show <select id="pageSize">
            <option value="10" selected>10</option>
            <option value="20">20</option>
            <option value="50">50</option>
            <option value="100">100</option>
        </select> rows
    </div>

<script>
// DEX list ordered by real DeFiLlama TVL
const dexList = ["All DEXs","Uniswap","PancakeSwap","Raydium","Orca","SushiSwap","Aerodrome","Velodrome","QuickSwap","Meteora","Pump.fun","HyperSwap","ProjectX","Shadow"];
const dexChainMap = {"Uniswap":"Ethereum","PancakeSwap":"BNB Chain","Raydium":"Solana","Orca":"Solana","SushiSwap":"Ethereum","Aerodrome":"Base","Velodrome":"Optimism","QuickSwap":"Polygon","Meteora":"Solana","Pump.fun":"Solana","HyperSwap":"HyperEVM","ProjectX":"HyperEVM","Shadow":"Sonic"};

// Fill DEX dropdown
const dexSelect = document.getElementById("dexFilter");
dexList.forEach(d => dexSelect.add(new Option(d,d)));
dexSelect.value = "All DEXs";

// Fill Chain dropdown
const chains = ["All Chains", ...new Set(Object.values(dexChainMap))].sort();
const chainSelect = document.getElementById("chainFilter");
chains.forEach(c => chainSelect.add(new Option(c,c)));

// Auto-chain when DEX changes (skip for "All DEXs")
dexSelect.onchange = () => {
    if(dexSelect.value !== "All DEXs") chainSelect.value = dexChainMap[dexSelect.value];
    else chainSelect.value = "All Chains";
    applyFilters();
};
chainSelect.onchange = applyFilters;

// Generate realistic mock data (208 pools total)
const tokens = ["USDC","USDT","SOL","ETH","WIF","BONK","JUP","MATIC","BNB","PEPE","SHIB","DOGE"];
let masterPools = [];
dexList.slice(1).forEach(dex => {
    for(let i=0;i<16;i++){
        const a = tokens[Math.floor(Math.random()*tokens.length)];
        const b = tokens[Math.floor(Math.random()*tokens.length)];
        const tvl = Math.round(Math.random()*15e6 + 5e4);
        const fees = Math.round(Math.random()*8e4 + 500);
        const feeTvl = Number(((fees/tvl)*100).toFixed(3));
        const trend = Math.random()<0.3?-1:(Math.random()<0.6?1:0);
        const priceData = Array.from({length:30},(_,j)=>100+Math.random()*300+j*trend*3+Math.random()*20-10);
        const drawdown = (Math.max(...priceData)-Math.min(...priceData))/Math.max(...priceData);
        const adjApr = Number((feeTvl*(1-drawdown)).toFixed(2));
        const age = dex==="Pump.fun"?`${Math.floor(Math.random()*10)+1}h`:`${Math.floor(Math.random()*365)+10}d`;

        masterPools.push({
            pair:`${a}/${b}`,dex,chain:dexChainMap[dex],age,tvl,fees,feeTvl,adjApr,
            volatility:(Math.random()*0.7+0.1).toFixed(2),
            correlation:(Math.random()*0.8+0.1).toFixed(2),
            rewardsTvl:(Math.random()*25).toFixed(2),
            volTvl:(Math.random()*250+20).toFixed(2),
            priceData,trend
        });
    }
});

let filteredPools = [...masterPools];
let currentDisplay = [];

// Pure SVG chart (always works)
function drawChart(el,data,trend){
    const color = trend===-1?"#ff4444":trend===1?"#00ff88":"#ffaa00";
    const min=Math.min(...data), max=Math.max(...data);
    if(max===min) { el.innerHTML=""; return; }
    const pts = data.map((v,i)=>`${i*110/29},${36-(v-min)/(max-min)*34}`).join(" ");
    el.innerHTML = `<svg width="110" height="36"><polyline fill="none" stroke="${color}" stroke-width="2" points="${pts}"/></svg>`;
}

function render(){
    const tbody = document.getElementById("poolsBody");
    tbody.innerHTML="";
    currentDisplay.forEach(p=>{
        const row = document.createElement("tr");
        row.innerHTML = `
            <td class="pair-cell"><span class="star">⭐</span> ${p.pair} <div class="mini-chart"></div></td>
            <td>${p.age}</td>
            <td>$${p.tvl.toLocaleString()}</td>
            <td>$${p.fees.toLocaleString()}</td>
            <td>${p.feeTvl.toFixed(2)}%</td>
            <td class="positive">${p.adjApr}%</td>
            <td>${p.volatility}</td>
            <td>${p.correlation}</td>
            <td>${p.rewardsTvl}%</td>
            <td>${p.volTvl}%</td>
            <td><button class="simulate">Simulate</button></td>`;
        tbody.appendChild(row);
        drawChart(row.querySelector(".mini-chart"), p.priceData, p.trend);
    });
}

// Main filter + smart ranking
function applyFilters(){
    const search = document.getElementById("searchInput").value.toLowerCase();
    const selectedDex = dexSelect.value;
    const selectedChain = chainSelect.value;

    filteredPools = masterPools.filter(p=>
        p.pair.toLowerCase().includes(search) &&
        (selectedDex==="All DEXs" || p.dex===selectedDex) &&
        (selectedChain==="All Chains" || p.chain===selectedChain)
    );

    // 1. Sort by Fee/TVL descending
    filteredPools.sort((a,b)=>b.feeTvl - a.feeTvl);

    // 2. Among the top Fee/TVL, prioritize highest APR (Adj. IL)
    filteredPools.sort((a,b)=>{
        if(Math.abs(a.feeTvl - b.feeTvl)<0.01) return b.adjApr - a.adjApr;
        return b.feeTvl - a.feeTvl;
    });

    updateDisplay();
}

function updateDisplay(){
    const size = parseInt(document.getElementById("pageSize").value);
    currentDisplay = filteredPools.slice(0, size);
    render();
}

// Sorting (user clicks)
let sortState = {};
function sortTable(col){
    const keys = ["pair","age","tvl","fees","feeTvl","adjApr","volatility","correlation","rewardsTvl","volTvl"];
    const key = keys[col];
    sortState[col] = sortState[col]==="asc"?"desc":"asc";
    filteredPools.sort((a,b)=>{
        let x=a[key], y=b[key];
        if(typeof x==="string") x=x.toLowerCase(), y=y.toLowerCase();
        else x=+x||0, y=+y||0;
        return sortState[col]==="asc"?(x>y?1:x<y?-1:0):(x<y?1:x>y?-1:0);
    });
    document.querySelectorAll("th").forEach((th,i)=>th.className=i===col?(sortState[col]==="asc"?"sort-asc":"sort-desc"):"");
    updateDisplay();
}

// Listeners
document.getElementById("searchInput").oninput = applyFilters;
document.getElementById("timeFilter").onchange = applyFilters;
document.getElementById("pageSize").onchange = updateDisplay;

// Initial load – super fast (only 10 rows)
document.addEventListener("DOMContentLoaded", ()=>{
    setTimeout(applyFilters, 100);
});
</script>
</body>
</html>
