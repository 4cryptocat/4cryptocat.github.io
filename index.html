<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discover - Unfiltered Liquidity Pools</title>
<style>
body { font-family: Arial, sans-serif; background: #111; color: #eee; margin: 0; padding: 20px; }
.header { display: flex; flex-wrap: wrap; gap: 15px; align-items: center; margin-bottom: 20px; }
h1 { margin: 0; font-size: 24px; }
.search-bar { padding: 10px; width: 300px; background: #333; border: none; border-radius: 4px; color: white; }
.filters select { padding: 8px; background: #333; color: white; border: 1px solid #555; border-radius: 4px; }
table { width: 100%; border-collapse: collapse; background: #222; font-size: 14px; overflow-x: auto; display: block; white-space: nowrap; }
th, td { padding: 10px 12px; border-bottom: 1px solid #444; text-align: right; }
th { background: #333; cursor: pointer; user-select: none; }
th:first-child, td:first-child { text-align: left; }
.pair-cell { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
.dex-info { display: flex; gap: 6px; align-items: center; font-size: 12px; color: #aaa; }
.dex-logo { width: 18px; height: 18px; border-radius: 4px; }
.pair-link { color: #00ff88; text-decoration: none; font-weight: bold; }
.pair-link:hover { text-decoration: underline; }
.mini-chart { width: 110px; height: 36px; background: #222; border: 1px solid #444; border-radius: 2px; overflow: hidden; }
.star { cursor: pointer; font-size: 18px; }
.simulate { background: #0066ff; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; }
.positive { color: #00ff88; }
.footer-controls { margin-top: 20px; text-align: right; }
.footer-controls select { padding: 8px; background: #333; color: white; border: 1px solid #555; border-radius: 4px; }
.loading { color: #888; text-align: center; padding: 20px; }
.sort-asc::after { content: " ↑"; color: #00ff88; }
.sort-desc::after { content: " ↓"; color: #ff6666; }
</style>
</head>
<body>
<div class="header">
<h1>Discover - Unfiltered Liquidity Pools</h1>
<input type="text" class="search-bar" placeholder="Search pair..." id="searchInput">
<div class="filters">
<select id="dexFilter"></select>
<select id="chainFilter"></select>
<select id="timeFilter">
<option>30 Days</option>
<option>7 Days</option>
<option>24 Hours</option>
</select>
</div>
</div>

<table>
<thead>
<tr>
<th onclick="sortTable(0)">Pair</th>
<th onclick="sortTable(1)">Age</th>
<th onclick="sortTable(2)">TVL</th>
<th onclick="sortTable(3)">Fees (24h)</th>
<th onclick="sortTable(4)">Fee/TVL</th>
<th class="positive" onclick="sortTable(5)">APR (Adj. IL)</th>
<th onclick="sortTable(6)">Volatility</th>
<th onclick="sortTable(7)">Correlation</th>
<th onclick="sortTable(8)">Rewards/TVL</th>
<th onclick="sortTable(9)">Volume/TVL</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="poolsBody"><tr class="loading"><td colspan="11">Loading pools...</td></tr></tbody>
</table>

<div class="footer-controls">
Show <select id="pageSize">
<option value="10" selected>10</option>
<option value="20">20</option>
<option value="50">50</option>
<option value="100">100</option>
</select> rows
</div>

<script>
// DEX list (keep existing)
const dexConfig = [
{name: "All DEXs", chain: "All Chains"},
{name: "Uniswap", chain: "Ethereum", version: "v3", logo: "https://raw.githubusercontent.com/Uniswap/logos/main/logo.png", poolUrl: "https://app.uniswap.org/explore/pools/ethereum/"},
{name: "PancakeSwap", chain: "BNB Chain", version: "v3", logo: "https://pancakeswap.finance/images/logo.png", poolUrl: "https://pancakeswap.finance/info/pool/"},
{name: "Raydium", chain: "Solana", version: "Concentrated", logo: "https://raydium.io/logo.png", poolUrl: "https://raydium.io/liquidity-pools/"},
{name: "Orca", chain: "Solana", version: "Whirl", logo: "https://orca.so/logo.png", poolUrl: "https://www.orca.so/pools"},
{name: "SushiSwap", chain: "Ethereum", version: "v3", logo: "https://www.sushi.com/images/logo.png", poolUrl: "https://www.sushi.com/pools"}
];

// Fill DEX dropdown
const dexSelect = document.getElementById("dexFilter");
dexConfig.forEach(d => dexSelect.add(new Option(d.name, d.name)));
dexSelect.value = "All DEXs";

const chainSelect = document.getElementById("chainFilter");
const uniqueChains = [...new Set(dexConfig.map(d => d.chain))];
uniqueChains.forEach(c => chainSelect.add(new Option(c, c)));

// Auto-chain select
dexSelect.onchange = () => {
if(dexSelect.value !== "All DEXs") chainSelect.value = dexConfig.find(d => d.name===dexSelect.value).chain;
applyFilters();
};
chainSelect.onchange = applyFilters;

let masterPools = [];
let filteredPools = [];
let currentDisplay = [];

// Fetch real pools from DexScreener API (EVM chains)
async function fetchPools() {
masterPools = [];
for(const dex of dexConfig.slice(1,6)){ // first 5 DEXs
try {
let url;
if(dex.chain==="Ethereum") url=`https://api.dexscreener.io/latest/dex/pairs/ethereum`;
else if(dex.chain==="BNB Chain") url=`https://api.dexscreener.io/latest/dex/pairs/bsc`;
else continue; // skip Solana for now (no front-end API)
const resp = await fetch(url);
const data = await resp.json();
for(const pair of data.pairs.slice(0,10)){ // take top 10 per DEX
masterPools.push({
pair: pair.baseToken.symbol+"/"+pair.quoteToken.symbol,
dex: dex.name,
chain: dex.chain,
version: dex.version,
logo: dex.logo,
poolUrl: dex.poolUrl + pair.pairAddress,
age: pair.age || "N/A",
tvl: Number(pair.liquidity.usd),
fees: Number(pair.feesUsd24h || 0),
feeTvl: pair.feesUsd24h && pair.liquidity.usd ? ((pair.feesUsd24h/pair.liquidity.usd)*100).toFixed(2) : 0,
adjApr: 0, // could compute from feeTvl minus impermanent loss if available
volatility: 0, correlation:0, rewardsTvl:0, volTvl:0,
priceData: pair.sparkline || Array(30).fill(100),
trend: 1
});
}
} catch(e){ console.error("Error fetching", dex.name, e); }
}
applyFilters();
}

function drawChart(el, data, trend){
const color = trend===-1?"#ff4444":trend===1?"#00ff88":"#ffaa00";
const min=Math.min(...data), max=Math.max(...data);
if(max===min){ el.innerHTML='<div style="line-height:36px;font-size:10px;color:#888">Flat</div>'; return; }
const points=data.map((v,i)=>`${i*110/29},${36-(v-min)/(max-min)*34}`).join(" ");
el.innerHTML=`<svg width="110" height="36"><polyline fill="none" stroke="${color}" stroke-width="2" points="${points}"/></svg>`;
}

function render(){
const tbody=document.getElementById("poolsBody");
tbody.innerHTML="";
currentDisplay.forEach(p=>{
const row=document.createElement("tr");
row.innerHTML=`
<td class="pair-cell">
<div class="dex-info">
<img src="${p.logo}" class="dex-logo">
<span>${p.version} • ${p.chain}</span>
</div>
<a href="${p.poolUrl}" target="_blank" class="pair-link" rel="noopener">${p.pair}</a>
<div class="mini-chart"></div>
</td>
<td>${p.age}</td>
<td>$${p.tvl.toLocaleString()}</td>
<td>$${p.fees.toLocaleString()}</td>
<td>${p.feeTvl}%</td>
<td class="positive">${p.adjApr}%</td>
<td>${p.volatility}</td>
<td>${p.correlation}</td>
<td>${p.rewardsTvl}%</td>
<td>${p.volTvl}%</td>
<td><button class="simulate">Simulate</button></td>`;
tbody.appendChild(row);
drawChart(row.querySelector(".mini-chart"), p.priceData, p.trend);
});
}

function applyFilters(){
const search=document.getElementById("searchInput").value.toLowerCase();
const selectedDex=dexSelect.value;
const selectedChain=chainSelect.value;
filteredPools=masterPools.filter(p=>
p.pair.toLowerCase().includes(search) &&
(selectedDex==="All DEXs"||p.dex===selectedDex) &&
(selectedChain==="All Chains"||p.chain===selectedChain)
);
filteredPools.sort((a,b)=>b.feeTvl-a.feeTvl);
updateDisplay();
}

function updateDisplay(){
const size=parseInt(document.getElementById("pageSize").value);
currentDisplay=filteredPools.slice(0,size);
render();
}

// Sorting
let sortState={};
function sortTable(col){
const keys=["pair","age","tvl","fees","feeTvl","adjApr","volatility","correlation","rewardsTvl","volTvl"];
const key=keys[col];
sortState[col]=sortState[col]==="asc"?"desc":"asc";
filteredPools.sort((a,b)=>{
let x=a[key], y=b[key];
if(typeof x==="string") x=x.toLowerCase(), y=y.toLowerCase();
else x=parseFloat(x)||0, y=parseFloat(y)||0;
return sortState[col]==="asc"?(x>y?1:x<y?-1:0):(x<y?1:x>y?-1:0);
});
document.querySelectorAll("th").forEach((th,i)=>th.className=i===col?(sortState[col]==="asc"?"sort-asc":"sort-desc"):"");
updateDisplay();
}

// Listeners
document.getElementById("searchInput").oninput=applyFilters;
document.getElementById("timeFilter").onchange=applyFilters;
document.getElementById("pageSize").onchange=updateDisplay;

// Initial load
document.addEventListener("DOMContentLoaded", fetchPools);
</script>
</body>
</html>
